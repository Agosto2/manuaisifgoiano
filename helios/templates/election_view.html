{% extends TEMPLATE_BASE %}
{% load i18n %}
{% block title %}{{election.name}}{% endblock %}
{% block content %}
<div class="row">
<div class="col-md-8">
  <h3 class="title">{{ election.name }}</h3>
</div>
</div>
<div class="row">
<div class="col-md-8">
{% trans "Election type" %}: <em>{% if election.private_p %}{% trans "private" %}{%else%}{% trans "public" %}{% endif %}</em> - 
{% if settings.SHOW_USER_INFO %} {% trans "created by" %} <u><b>{{election.admin.pretty_name}}</b></u>{% endif %}
{% if election.is_archived %}
[archived]
{% endif %}
{% if admin_p %}
{% if not election.frozen_at %}
<a title="{% trans "edit" %}" href="{% url helios.views.one_election_edit election.uuid %}"><i class="glyphicon glyphicon-edit"></i></a>
{% endif %}
{% if election.is_archived %}<a class="small button" href="{% url helios.views.one_election_archive election_uuid=election.uuid %}?archive_p=0">{% trans "unarchive it" %}</a>{% else %}<a class="small button" href="{% url helios.views.one_election_archive election_uuid=election.uuid %}?archive_p=1"> <i title="{% trans "archive it" %}" class="glyphicon glyphicon-briefcase"></i></a>{% endif %}
{% endif %}
</div>
</div>

<br /><br />

<br clear="left" />

<div style="margin-bottom: 25px; ">
{{election.description_bleached|safe}}
</div>

{% if election.election_info_url %}
<p style="font-size:1.5em;">[<a target="_blank" href="{{election.election_info_url}}">
{% blocktrans %}download candidate bios &amp; statements{% endblocktrans %}</a>]</p>
{% endif %}
<div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
<h4 class="page-header">
<div class="row placeholders">
<div class="col-xs-6 col-sm-3 placeholder">
<a class="label label-success" href="{% url helios.views.one_election_questions election.uuid %}">{% trans "questions" %} <span class="badge">{% if election.questions %}{{election.questions|length}}{% else %}0{% endif %}</span></a>
</div>
<div class="col-xs-6 col-sm-3 placeholder">
<a class="label label-success" href="{% url helios.views.voters_list_pretty election.uuid %}">{% blocktrans %}voters &amp; ballots{% endblocktrans %}</a>
</div>
<div class="col-xs-6 col-sm-3 placeholder">
<a class="label label-success" href="{% url helios.views.list_trustees_view election.uuid %}">{% trans "trustees" %} <span class="badge">{{trustees|length}}</span></a>
</div>
</h4>
</div>
<div class="row">
<div class="col-md-12">
{% if admin_p %}
{% if election.frozen_p %}
<div style="background: lightyellow; padding:5px; padding-left: 10px; margin-top: 15px; border: 1px solid #aaa; width: 720px;" class="round">
<a href="#" onclick="$('#badgebody').slideToggle(250);"> {% trans "Embed an Election Badge" %}</a>
<div id="badgebody" style="display:none;">
<br />
<form action="#">
<textarea cols="90" rows="4" wrap="soft">&lt;iframe src="{{election_badge_url}}" frameborder="0" style="border: 1px solid black" height="75" width="200"&gt;
&lt;/iframe&gt;</textarea><br />
<p style="font-size:0.8em;">{% trans "adding this HTML to your site displays a thin banner with direct links to voting." %}</p>
</form>
</div>
</div>
{% endif %}
<p>

{% if election.result %}

<!-- election complete, no next step -->

{% else %}
<b>{% trans "Next Step:" %}</b>
<span style="font-size: 1.3em;">
{% if not election.frozen_at %}
{% if election.issues_before_freeze %}
{% for issue in election.issues_before_freeze %}
{{issue.action}}{% if forloop.last %}{% else %}, {% trans "and" %}{% endif %}
{% endfor %}
{% else %}
<a href="{% url helios.views.one_election_freeze election.uuid %}">{% trans "freeze ballot and open election." %}</a>
<br />
{% if election.voting_starts_at %}
{% blocktrans %}
once you do this, the election will be ready for voting and will open automatically
{% endblocktrans %}
<br />
at {{election.voting_starts_at}}, as per your settings.
{% else %}
{% blocktrans %}
once you do this, the election will be immediately open for voting.
{% endblocktrans %}
{% endif %}
{% endif %}

{% else %}

{% if not election.encrypted_tally %}
{% if election.tallying_started_at %}
{% blocktrans %}
Tally computation is under way.<br />
Reload this page in a couple of minutes.
{% endblocktrans %}
{% else %}
<a href="{% url helios.views.one_election_compute_tally election.uuid %}">
{% blocktrans %}
compute encrypted tally</a><br />
The encrypted votes will be combined into an encrypted tally. Once this is done,<br />
trustees will be asked to provide their share of the decryption.
{% endblocktrans %}
{% endif %}
{% else %}

{% if election.ready_for_decryption_combination %}
<a href="{% url helios.views.combine_decryptions election.uuid %}">
{% if election.num_trustees == 1 %}
{% trans "release results" %}
{% else %}
{% trans "combine trustee decryptions and release results" %}
{% endif %}
</a><br />
{% if election.num_trustees == 1 %}
{% trans "The result is released and all voters are notified." %}
{% else %}
{% blocktrans %}
The decryption shares from the trustees are combined and the tally is decrypted.<br />
Once you do this, the tally will be immediately available for all to see, and
all voters will be notified that the tally is ready.
{% endblocktrans %}
{% endif %}
{% else %}
<a href="{% url helios.views.list_trustees_view election.uuid %}">
{% trans "trustees (for decryption)" %}</a>
{% endif %}

{% endif %}

{% endif %}
</span>

{% endif %}

</p>

{% endif %}

<br /><br />

{% if election.result %}
<span class="highlight-box round">
    {% trans "This election is complete." %}
</span><br />

<br />
<h3 class="highlight-box">{% trans "Tally" %}</h3>
{% for question in election.pretty_result %}
<b><span style="font-size:0.8em;">{% trans "Question" %} #{{forloop.counter}}</span><br />{{question.question}}</b><br />
<table class="pretty" style="width: auto;">
{% for answer in question.answers %}
<tr><td style="padding-right:80px;{% if answer.winner %}font-weight:bold;{% endif %}">{{answer.answer}}</td><td align="right" style="{% if answer.winner %}font-weight:bold;{% endif %}">{{answer.count}}</td></tr>
{% endfor %}
</table>
{% endfor %}

{% else %}

{% if election.voting_has_stopped %}
<span class="highlight-box round">
    {% trans "Election closed. Tally will be computed soon."  %}
</span><br />
{% else %}

{% if election.voting_has_started %}
<a class="btn btn-lg btn-primary" role="button" href="{{test_cookie_url}}">
{% trans "Vote in this" %} {{election.pretty_type}} 
</a>
<br />
<br />
{% if election.voting_extended_until %}
{% blocktrans with pretty_type=election.pretty_type %}
This {{pretty_type}} was initially scheduled to end at {{election.voting_ends_at}} (UTC),<br />
but has been extended until {{ election.voting_extended_until }} (UTC).
{% endblocktrans %}
{% else %}
{% if election.voting_ends_at %}
<br />
{% blocktrans with pretty_type=election.pretty_type %}
This {{pretty_type}} is scheduled to end at {{election.voting_ends_at}} (UTC).
{% endblocktrans %}
{% else %}
{% trans "This {{election.pretty_type}} ends at the administrator's discretion." %}
{% endif %}
<br />
{% endif %}
</div>
</div>
<div class="row">
<div class="col-md-12">
{% if election.private_p and voter %}
<br />
{% blocktrans %}
This election is <em>private</em>. You are signed in as eligible voter <em>{{voter.name}}</em>.
{% endblocktrans %}
{% endif %}

<div class="alert alert-info" style="font-size: 1.2em; margin-right: 400px; display:none;" id="nojava_message">
{% blocktrans %}
  You do not have Java installed in your browser.<br />At this time, Helios requires Java.<br />
  Visit <a target="_new" href="http://java.sun.com">java.sun.com</a> to install it.
  {% endblocktrans %}
</div>
<br />
{% else %}
<span class="alert alert-info">
  {% trans "voting is not yet open" %}
</span> <br /><br />
{% endif %}
</div>
</div>
<br>
<div class="row">
<div class="col-md-12">
{% if user %}
{% if voter %}
<p style="padding-top:1px;">
{% trans "You are registered to vote in this" %} {{pretty_type}}.
{% if election.use_voter_aliases %}
{% blocktrans %}
Your voter alias is {{voter.alias}}.
{% endblocktrans %}
{% endif %}
</p>

{% else %}
{% if election.result %}
{% else %}
{% if election.openreg %}
{% if eligible_p %}
<em>{% trans "You are eligible to vote in this election." %}</em>
{% else %}
{% trans "You are <em>not eligible</em> to vote in this" %} {{election.pretty_type}}.
{% endif %}
{% else %}

{% trans "You are <em>not eligible</em> to vote in this" %} {{election.pretty_type}}.

<br />

{% endif %}
{% endif %}
{% endif %}
{% else %}

{% if election.openreg %}
{% if election.eligibility %}

{% trans "This election is open to:" %} <!--{{election.pretty_eligibility|safe}}-->
<br /><br/><ul><li><i>{% trans "Any user with credentials" %}</i></li></ul><br/>
<a href="{{settings.SECURE_URL_HOST}}{% url helios_auth.views.index %}?return_url={{CURRENT_URL}}">{% trans "Log in </a> to check your eligibility." %}
{% else %}
{% trans "Anyone can vote in this election." %}
{% endif %}
{% endif %}

{% endif %}

{% endif %}

{% endif %}
</div>
</div>
<br>
<div class="row">
<div class="col-md-12">
<table class="table table-striped">
	<thead>
		<th>{% trans "Election URL:" %}</th>
		<th>{% trans "Election Fingerprint:" %}</th>
	</thead>
	<tbody>
		<tr>
			<td><a href="{{election.url}}">{{election.url}}</a></td>
			<td><strong>{{election.hash}}</strong></td>
		</tr>
</tbody>
</table>
</div>
</div>

{% endblock %}
